# CLAUDE.md

https://github.com/ryoppippi/ccusage
`npx ccusage@latest` コマンド相当の情報をMacの通知バーに表示するアプリです。

参考：
```
┌──────────────┬──────────────────────────────────────┬──────────────┬──────────────┬──────────────┬──────────────┬──────────────┬────────────┐
│ Date         │ Models                               │        Input │       Output │ Cache Create │   Cache Read │ Total Tokens │ Cost (USD) │
├──────────────┼──────────────────────────────────────┼──────────────┼──────────────┼──────────────┼──────────────┼──────────────┼────────────┤
│ 2025-05-27   │ claude-3-7-sonnet-20250219, sonnet-4 │           13 │          105 │       26,879 │       13,386 │       40,383 │      $0.11 │
├──────────────┼──────────────────────────────────────┼──────────────┼──────────────┼──────────────┼──────────────┼──────────────┼────────────┤
│ 2025-05-28   │ sonnet-4                             │          362 │       66,396 │      324,646 │    5,521,555 │    5,912,959 │      $3.87 │
├──────────────┼──────────────────────────────────────┼──────────────┼──────────────┼──────────────┼──────────────┼──────────────┼────────────┤
│ 2025-05-31   │ sonnet-4                             │        1,529 │        2,317 │       48,443 │      191,538 │      243,827 │      $0.28 │
├──────────────┼──────────────────────────────────────┼──────────────┼──────────────┼──────────────┼──────────────┼──────────────┼────────────┤
│ 2025-06-01   │ sonnet-4                             │          936 │       52,860 │      727,687 │   12,347,133 │   13,128,616 │      $7.23 │
├──────────────┼──────────────────────────────────────┼──────────────┼──────────────┼──────────────┼──────────────┼──────────────┼────────────┤
│ 2025-06-02   │ sonnet-4                             │        1,161 │        3,507 │       50,946 │      274,419 │      330,033 │      $0.33 │
├──────────────┼──────────────────────────────────────┼──────────────┼──────────────┼──────────────┼──────────────┼──────────────┼────────────┤
│ 2025-06-04   │ sonnet-4                             │           27 │       18,772 │       35,924 │      425,789 │      480,512 │      $0.54 │
├──────────────┼──────────────────────────────────────┼──────────────┼──────────────┼──────────────┼──────────────┼──────────────┼────────────┤
│ 2025-06-06   │ sonnet-4                             │           28 │          656 │       22,704 │       53,244 │       76,632 │      $0.11 │
├──────────────┼──────────────────────────────────────┼──────────────┼──────────────┼──────────────┼──────────────┼──────────────┼────────────┤
│ 2025-06-07   │ claude-3-7-sonnet-20250219           │           14 │            4 │       30,906 │       14,111 │       45,035 │      $0.12 │
├──────────────┼──────────────────────────────────────┼──────────────┼──────────────┼──────────────┼──────────────┼──────────────┼────────────┤
│ 2025-06-08   │ claude-3-7-sonnet-20250219, sonnet-4 │       14,712 │      113,179 │    2,483,187 │   41,035,104 │   43,646,182 │     $23.36 │
├──────────────┼──────────────────────────────────────┼──────────────┼──────────────┼──────────────┼──────────────┼──────────────┼────────────┤
│ 2025-06-09   │ sonnet-4                             │          619 │        9,229 │      664,424 │    8,507,926 │    9,182,198 │      $5.18 │
├──────────────┼──────────────────────────────────────┼──────────────┼──────────────┼──────────────┼──────────────┼──────────────┼────────────┤
│ 2025-06-10   │ opus-4, sonnet-4                     │        7,661 │       95,173 │    1,845,031 │   24,151,582 │   26,099,447 │     $48.62 │
├──────────────┼──────────────────────────────────────┼──────────────┼──────────────┼──────────────┼──────────────┼──────────────┼────────────┤
│ 2025-06-11   │ opus-4                               │          309 │        9,805 │      665,540 │    3,917,450 │    4,593,104 │     $19.10 │
├──────────────┼──────────────────────────────────────┼──────────────┼──────────────┼──────────────┼──────────────┼──────────────┼────────────┤
│ 2025-06-12   │ opus-4, sonnet-4                     │        2,033 │       61,655 │    1,205,526 │   22,655,311 │   23,924,525 │     $57.40 │
├──────────────┼──────────────────────────────────────┼──────────────┼──────────────┼──────────────┼──────────────┼──────────────┼────────────┤
│ 2025-06-13   │ opus-4, sonnet-4                     │        4,534 │      138,687 │    4,553,451 │   91,142,729 │   95,839,401 │    $179.09 │
├──────────────┼──────────────────────────────────────┼──────────────┼──────────────┼──────────────┼──────────────┼──────────────┼────────────┤
│ 2025-06-14   │ opus-4, sonnet-4                     │          840 │       25,963 │      684,682 │   19,863,036 │   20,574,521 │     $36.32 │
├──────────────┼──────────────────────────────────────┼──────────────┼──────────────┼──────────────┼──────────────┼──────────────┼────────────┤
│ ──────────── │ ────────────                         │ ──────────── │ ──────────── │ ──────────── │ ──────────── │ ──────────── │ ────────── │
├──────────────┼──────────────────────────────────────┼──────────────┼──────────────┼──────────────┼──────────────┼──────────────┼────────────┤
│ Total        │                                      │       34,778 │      598,308 │   13,369,976 │  230,114,313 │  244,117,375 │    $381.67 │
└──────────────┴──────────────────────────────────────┴──────────────┴──────────────┴──────────────┴──────────────┴──────────────┴────────────┘
```

今日の使用料金を通知バーに表示します。
通知バーにカーソルを合わせると詳細が表示されます。




作業を進めるときは @.claude/todos フォルダに TODOチェックリストを作って、更新しながら作業をしてください。
タスクが増えてきた場合、todoを分割してください。
複数のtodoがある場合、それをまとめた親todoリストを作ってください。


アプリケーション実装時はスキーマ駆動を徹底してください。
テーブル定義やAPI定義、JSONSchema定義、データ加工フローを先に考えてドキュメントや部分的な実装に落とし込みます。
UIを先に考えてはいけません。


## 開発方針

このプロジェクトの開発方針は以下のドキュメントを参照してください：
- `docs/development-policy.md` - 開発方針書（アーキテクチャ、技術スタック、機能要件など）


This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.



### 設計ドキュメント
以下の設計ドキュメントを必ず参照してください：
- `docs/designdoc.md` - システム全体設計書
- `docs/database-schema.sql` - データベーススキーマ定義
- `docs/api-spec.yaml` - OpenAPI仕様書
- `docs/data-flow.md` - データ処理フロー設計
- `docs/development-tasks.md` - 開発タスク詳細
- `docs/development-checklist.md` - 開発チェックリスト

## Repository Structure

```
.
├── README.md
├── Taskfile.yml               # Task runner configuration
├── biome.jsonc                # Biome.js configuration for linting/formatting
└── docs/
    ├── adr/                   # Architecture Decision Records
    ├── designdoc.md           # System specification document
    ├── feature/               # Gherkin feature files (.feature)
    ├── requirements/          # USDM Requirements files (.yaml)
```

## Development Process

スキーマ駆動開発に従い、以下の順序で開発を進めます：

1. **設計フェーズ**:
   - システム全体設計書の作成・更新
   - データベーススキーマ設計
   - API仕様書作成
   - データ処理フロー設計

2. **実装フェーズ**:
   - データベース環境構築
   - データモデル実装
   - クローラー実装
   - APIサーバー実装
   - フロントエンド実装

3. **品質保証**:
   - ユニットテスト実装
   - 統合テスト実装
   - E2Eテスト実装
   - パフォーマンステスト

4. **デプロイ・運用**:
   - Docker環境構築
   - CI/CD設定
   - 監視・ログ設定

## Technology Stack

### Python
- Web Framework: FastAPI
- CLI Framework: Typer
- Package Management: uv
- Lint/Format: Ruff
- Testing: pytest
- Type Checking: Typing
- Model Definition: Pydantic
- Environment/Configuration: Pydantic-Settings
- Database: SQLite
- ORM: SQLAlchemy
- Crawler: BeautifulSoup + httpx

### TypeScript
- Web Framework: React or Next.js
- Package Management: pnpm
- Lint/Format: Biome.js
- Testing: Vitest
- Validation: Zod

## Commands

### Task Runner

```bash
# List available tasks
task list

# Run default task
task
```

### Python Development

```bash
# Initialize project
uv init --name project_name --python 3.12

# Add dependencies
uv add fastapi uvicorn sqlalchemy pydantic pydantic-settings
uv add beautifulsoup4 httpx typer
uv add --dev ruff pytest pyright pytest-cov

# Run Python code
uv run python entry_point.py
uv run python -m entry.module

# Linting and formatting
uv run ruff check --fix --unsafe-fixes
uv run ruff format

# Run tests
uv run pytest -v --cov
```

### TypeScript Development

```bash
# Project setup (Next.js)
npx create-next-app@latest project_name --ts --tailwind --src-dir --eslint no --use-pnpm --disable-git --app --turbopack --import-alias "@/*"

pnpm add --save-dev --save-exact @biomejs/biome vitest

pnpm biome init --jsonc

# Linting and formatting
npx @biomejs/biome check --write ./src
```
